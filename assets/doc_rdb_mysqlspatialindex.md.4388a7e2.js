import{_ as s,c as a,o as n,b as l}from"./app.8396d735.js";const d=JSON.parse('{"title":"MYSQL 地理空间索引","description":"","frontmatter":{},"headers":[],"relativePath":"doc/rdb/mysqlspatialindex.md","lastUpdated":1678419541000}'),p={name:"doc/rdb/mysqlspatialindex.md"},e=l(`<h1 id="mysql-地理空间索引" tabindex="-1">MYSQL 地理空间索引 <a class="header-anchor" href="#mysql-地理空间索引" aria-hidden="true">#</a></h1><p>地理空间索引是mysql的一种新型索引，用于在几何值列上创建R-tree索引，以提高空间查询的效率。</p><h2 id="限制条件" tabindex="-1">限制条件 <a class="header-anchor" href="#限制条件" aria-hidden="true">#</a></h2><ul><li>表必须是InnoDB存储引擎。</li><li>列必须是geometry类型，并且有NOT NULL约束。</li><li>列必须有一个确定的SRID（空间参考标识符）。</li></ul><h2 id="srid-空间参考标识符" tabindex="-1">SRID（空间参考标识符） <a class="header-anchor" href="#srid-空间参考标识符" aria-hidden="true">#</a></h2><p>SRID是空间参考标识符的缩写，它表示<strong>一个几何值所定义的坐标空间</strong>。在mysql中，SRID是一个整数，与几何值相关联。不同的SRID代表不同的坐标系统，如WGS 84（世界地理坐标系），EPSG 3857（Web墨卡托投影）等。</p><ul><li><a href="https://en.wikipedia.org/wiki/World_Geodetic_System" target="_blank" rel="noreferrer">WGS 84（世界地理坐标系）</a>: 一种用于制图、大地测量和卫星导航（包括 GPS）的标准。它由一个参考椭球体、一个标准坐标系、高程数据和一个大地水准面组成。它使用地球的质心作为坐标原点。</li><li><a href="https://en.wikipedia.org/wiki/Web_Mercator_projection" target="_blank" rel="noreferrer">EPSG 3857（Web墨卡托投影）</a>: 一种用于网上地图和可视化的投影坐标系。它使用球形的椭球坐标，相对于 WGS 84 / World Mercator (CRS code 3395) 有 0.7% 的比例尺误差和最多 43km 的纬度差异。它被 Google、OpenStreetMap 和 Leaflet 等网上服务广泛采用。</li></ul><p>要获取一个几何值的SRID，可以使用ST_SRID()函数，例如：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">-- get SRID of a point</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> ST_SRID(ST_PointFromText(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">POINT(5 5)</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">4326</span><span style="color:#A6ACCD;">));</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- returns 4326</span></span>
<span class="line"></span></code></pre></div><p>要创建一个新的空间参考系统，并指定其SRID和其他属性，可以使用<strong>CREATE SPATIAL REFERENCE SYSTEM</strong>语句，例如：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">-- create a new spatial reference system with SRID 1000</span></span>
<span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">SPATIAL</span><span style="color:#A6ACCD;"> REFERENCE </span><span style="color:#F78C6C;">SYSTEM</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">my_srs</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#A6ACCD;">IDENTIFIED </span><span style="color:#F78C6C;">BY</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1000</span></span>
<span class="line"><span style="color:#A6ACCD;">ORGANIZATION </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">EPSG</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> IDENTIFIED </span><span style="color:#F78C6C;">BY</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3857</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><h2 id="地理空间索引创建示例" tabindex="-1">地理空间索引创建示例 <a class="header-anchor" href="#地理空间索引创建示例" aria-hidden="true">#</a></h2><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">-- create a table with geometry column</span></span>
<span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">TABLE</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">geom</span><span style="color:#A6ACCD;"> (</span></span>
<span class="line"><span style="color:#A6ACCD;">  id </span><span style="color:#C792EA;">INT</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">PRIMARY KEY</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  g </span><span style="color:#F78C6C;">GEOMETRY</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">NOT NULL</span><span style="color:#A6ACCD;"> SRID </span><span style="color:#F78C6C;">4326</span></span>
<span class="line"><span style="color:#A6ACCD;">) ENGINE</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">InnoDB;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- add a spatial index on geometry column</span></span>
<span class="line"><span style="color:#F78C6C;">ALTER</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">TABLE</span><span style="color:#A6ACCD;"> geom </span><span style="color:#F78C6C;">ADD</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">SPATIAL</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">INDEX</span><span style="color:#A6ACCD;"> (g);</span></span>
<span class="line"></span></code></pre></div><h2 id="如何使用地理空间索引进行查询" tabindex="-1">如何使用地理空间索引进行查询 <a class="header-anchor" href="#如何使用地理空间索引进行查询" aria-hidden="true">#</a></h2><p>使用MATCH()和AGAINST()函数，以及一些空间函数，如ST_Contains(), ST_Intersects(), ST_Distance()等</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">-- 查询多边形内的点</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> geom</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> MATCH(g) AGAINST(ST_PolygonFromText(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">POLYGON((0 0, 10 0, 10 10, 0 10, 0 0))</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">IN</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">BOOLEAN</span><span style="color:#A6ACCD;"> MODE);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- 查询距另一点一定距离内的点</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> geom</span></span>
<span class="line"><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> MATCH(g) AGAINST(ST_Buffer(ST_PointFromText(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">POINT(5 5)</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">), </span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">IN</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">BOOLEAN</span><span style="color:#A6ACCD;"> MODE);</span></span>
<span class="line"></span></code></pre></div>`,16),o=[e];function t(c,r,C,i,y,A){return n(),a("div",null,o)}const F=s(p,[["render",t]]);export{d as __pageData,F as default};
