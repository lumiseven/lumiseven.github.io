import{_ as s,c as n,o as l,b as a}from"./app.6723d690.js";const i=JSON.parse('{"title":"sentinel","description":"","frontmatter":{},"headers":[],"relativePath":"doc/jvm/sentinel.md","lastUpdated":1683013802000}'),p={name:"doc/jvm/sentinel.md"},o=a(`<h1 id="sentinel" tabindex="-1">sentinel <a class="header-anchor" href="#sentinel" aria-hidden="true">#</a></h1><p>Sentinel是一个面向分布式微服务架构的轻量级高可用流量控制组件，它主要以流量为切入点，从流量控制、熔断降级、系统负载保护等多个维度帮助用户保护服务的稳定性。</p><p>Sentinel具有以下特点：</p><p>丰富的应用场景：Sentinel承接了阿里巴巴近10年的双十一大促流量的核心场景，例如秒杀、消息削峰填谷、集群流量控制、实时熔断下游不可用应用等。 完备的实时监控：Sentinel提供实时的监控控制台，可以实时查看应用的流量、QPS、响应时间、异常比例等指标，以及配置和管理限流规则、熔断规则等。 广泛的开源生态：Sentinel提供了与多种开源框架/库的整合模块，例如与Spring Cloud、Dubbo、gRPC等的整合。 完善的SPI扩展点：Sentinel提供了简单易用、完善的SPI扩展接口，可以通过实现扩展接口来定制逻辑，例如定制规则管理、适配动态数据源等。</p><h2 id="示例" tabindex="-1">示例 <a class="header-anchor" href="#示例" aria-hidden="true">#</a></h2><p>Sentinel的使用步骤大致可以分为三步：</p><ol><li>引入依赖：根据你的项目类型和框架，选择合适的Sentinel依赖，例如Spring Boot、Spring Cloud、Dubbo等。</li><li>定义资源：资源是Sentinel的保护对象，可以是方法签名、URL、服务名称等。你需要用Sentinel API的SphU.entry(&quot;资源名&quot;)和entry.exit()来包围你需要控制流量的代码。</li><li>定义规则：规则是Sentinel的控制逻辑，可以是限流规则、熔断规则、热点规则等。你可以用Sentinel API的FlowRuleManager.loadRules()等方法来加载规则，或者用Sentinel控制台来配置和管理规则。</li></ol><p>下面是一个简单的示例代码，演示了如何使用Sentinel API来定义资源和限流规则：</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">com</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">alibaba</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">csp</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">sentinel</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">Entry</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">com</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">alibaba</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">csp</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">sentinel</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">SphU</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">com</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">alibaba</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">csp</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">sentinel</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">slots</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">block</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">BlockException</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">com</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">alibaba</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">csp</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">sentinel</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">slots</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">block</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">flow</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">FlowRule</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">com</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">alibaba</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">csp</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">sentinel</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">slots</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">block</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">flow</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">FlowRuleManager</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">java</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">util</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">ArrayList</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">java</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">util</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">List</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">SentinelDemo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">[]</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 定义资源名</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> resourceName </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">HelloWorld</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 配置限流规则</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">initFlowRules</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">resourceName</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(true)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">            </span><span style="color:#676E95;font-style:italic;">// 定义资源</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#C792EA;">Entry</span><span style="color:#A6ACCD;"> entry </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                entry </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> SphU</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">entry</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">resourceName</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">// 资源中的逻辑</span></span>
<span class="line"><span style="color:#A6ACCD;">                System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hello world</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">BlockException</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">// 资源访问被阻止，被限流或被降级</span></span>
<span class="line"><span style="color:#A6ACCD;">                System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">blocked!</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">finally</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">                </span><span style="color:#676E95;font-style:italic;">// 释放资源</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">entry </span><span style="color:#89DDFF;">!=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                    entry</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">exit</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">initFlowRules</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">resourceName</span><span style="color:#89DDFF;">){</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">List</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">FlowRule</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> rules </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">ArrayList</span><span style="color:#89DDFF;">&lt;&gt;();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">FlowRule</span><span style="color:#A6ACCD;"> rule </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">FlowRule</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 设置资源名</span></span>
<span class="line"><span style="color:#A6ACCD;">        rule</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setResource</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">resourceName</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 设置限流阈值为每秒 5 个请求</span></span>
<span class="line"><span style="color:#A6ACCD;">        rule</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setCount</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">5</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 设置限流模式为 QPS</span></span>
<span class="line"><span style="color:#A6ACCD;">        rule</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setGrade</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">RuleConstant</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">FLOW_GRADE_QPS</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        rules</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">rule</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 加载限流规则</span></span>
<span class="line"><span style="color:#A6ACCD;">        FlowRuleManager</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">loadRules</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">rules</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div><h2 id="sentinel和hystrix有什么区别" tabindex="-1">Sentinel和Hystrix有什么区别？ <a class="header-anchor" href="#sentinel和hystrix有什么区别" aria-hidden="true">#</a></h2><p>Sentinel和Hystrix都是分布式系统的流量控制和熔断组件，但是它们有一些区别，主要有以下几点：</p><ul><li>隔离策略：Hystrix支持线程池和信号量两种隔离策略，可以防止故障的传播和级联。Sentinel不提供隔离策略，而是依赖于应用本身的线程池或者执行模型。</li><li>资源定义：Hystrix的资源定义和隔离规则强相关，需要使用Hystrix Command来包装资源，并指定隔离规则。Sentinel的资源定义和规则配置的耦合度更低，只需要用Sentinel API来标识资源，规则可以在任何时候动态修改。</li><li>规则配置：Hystrix的规则配置比较固定，需要在代码中或者配置文件中指定。Sentinel的规则配置更灵活，可以通过API、控制台、动态数据源等方式来配置和管理。</li><li>流量控制：Hystrix的流量控制只支持基于QPS的限流模式，而Sentinel支持多种限流模式，如QPS、并发数、响应时间等，并且支持集群限流和链路限流等功能。</li><li>熔断降级：Hystrix的熔断降级只支持基于异常比例和异常数的触发条件，而Sentinel支持多种触发条件，如异常比例、异常数、平均响应时间、慢调用比例等，并且支持基于RT、异常比例、异常数的自适应降级策略。</li></ul>`,12),e=[o];function t(c,r,D,y,F,A){return l(),n("div",null,e)}const E=s(p,[["render",t]]);export{i as __pageData,E as default};
