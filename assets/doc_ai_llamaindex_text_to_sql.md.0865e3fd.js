import{_ as s,c as n,o as a,a as l}from"./app.988cb848.js";const C=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"doc/ai/llamaindex_text_to_sql.md","lastUpdated":1733723826000}'),p={name:"doc/ai/llamaindex_text_to_sql.md"},o=l(`<h2 id="llama-index-text-to-sql" tabindex="-1">llama-index text-to-sql <a class="header-anchor" href="#llama-index-text-to-sql" aria-hidden="true">#</a></h2><div class="language-mermaid"><button title="Copy Code" class="copy"></button><span class="lang">mermaid</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">graph</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">LR</span></span>
<span class="line"><span style="color:#A6ACCD;">    A</span><span style="color:#89DDFF;font-style:italic;">[</span><span style="color:#C3E88D;">用户输入自然语言查询</span><span style="color:#89DDFF;font-style:italic;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">--&gt;</span><span style="color:#A6ACCD;"> B</span><span style="color:#89DDFF;font-style:italic;">[</span><span style="color:#C3E88D;">大型语言模型 LLM</span><span style="color:#89DDFF;font-style:italic;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">    B </span><span style="color:#89DDFF;font-style:italic;">--&gt;</span><span style="color:#A6ACCD;"> C</span><span style="color:#89DDFF;font-style:italic;">{</span><span style="color:#C3E88D;">理解查询意图</span><span style="color:#89DDFF;font-style:italic;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    C </span><span style="color:#89DDFF;font-style:italic;">--&gt;</span><span style="color:#A6ACCD;"> D</span><span style="color:#89DDFF;font-style:italic;">[</span><span style="color:#C3E88D;">结合数据库结构信息</span><span style="color:#89DDFF;font-style:italic;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">    D </span><span style="color:#89DDFF;font-style:italic;">--&gt;</span><span style="color:#A6ACCD;"> E</span><span style="color:#89DDFF;font-style:italic;">[</span><span style="color:#C3E88D;">生成SQL查询</span><span style="color:#89DDFF;font-style:italic;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">    E </span><span style="color:#89DDFF;font-style:italic;">--&gt;</span><span style="color:#A6ACCD;"> F</span><span style="color:#89DDFF;font-style:italic;">[</span><span style="color:#C3E88D;">执行SQL查询</span><span style="color:#89DDFF;font-style:italic;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">    F </span><span style="color:#89DDFF;font-style:italic;">--&gt;</span><span style="color:#A6ACCD;"> G</span><span style="color:#89DDFF;font-style:italic;">[</span><span style="color:#C3E88D;">获取查询结果</span><span style="color:#89DDFF;font-style:italic;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">    G </span><span style="color:#89DDFF;font-style:italic;">--&gt;</span><span style="color:#A6ACCD;"> H</span><span style="color:#89DDFF;font-style:italic;">[</span><span style="color:#C3E88D;">LLM解释结果</span><span style="color:#89DDFF;font-style:italic;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">    H </span><span style="color:#89DDFF;font-style:italic;">--&gt;</span><span style="color:#A6ACCD;"> I</span><span style="color:#89DDFF;font-style:italic;">[</span><span style="color:#C3E88D;">生成自然语言回答</span><span style="color:#89DDFF;font-style:italic;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">    I </span><span style="color:#89DDFF;font-style:italic;">--&gt;</span><span style="color:#A6ACCD;"> J</span><span style="color:#89DDFF;font-style:italic;">[</span><span style="color:#C3E88D;">向用户展示结果</span><span style="color:#89DDFF;font-style:italic;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">classDef</span><span style="color:#A6ACCD;"> default </span><span style="color:#C3E88D;">fill:#e6e6fa,stroke:#4b0082,stroke-width:2px,color:#4b0082;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">classDef</span><span style="color:#A6ACCD;"> llm </span><span style="color:#C3E88D;">fill:#4b0082,stroke:#4b0082,stroke-width:2px,color:#e6e6fa;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">classDef</span><span style="color:#A6ACCD;"> process </span><span style="color:#C3E88D;">fill:#4169e1,stroke:#4b0082,stroke-width:2px,color:#e6e6fa;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">classDef</span><span style="color:#A6ACCD;"> decision </span><span style="color:#C3E88D;">fill:#6a5acd,stroke:#4b0082,stroke-width:2px,color:#e6e6fa;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">class</span><span style="color:#A6ACCD;"> A,J </span><span style="color:#C3E88D;">default</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">class</span><span style="color:#A6ACCD;"> B,H </span><span style="color:#C3E88D;">llm</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">class</span><span style="color:#A6ACCD;"> C </span><span style="color:#C3E88D;">decision</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">class</span><span style="color:#A6ACCD;"> D,E,F,G,I </span><span style="color:#C3E88D;">process</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">%</span><span style="color:#A6ACCD;">pip install llama</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">index</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">llms</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">openrouter</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">!pip install llama</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">index</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> os</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> llama_index</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">llms</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">openrouter </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> OpenRouter</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> llama_index</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">core</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">llms </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> ChatMessage</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">os</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">environ</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">OPENROUTER_API_KEY</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">sk-or-v1-</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> IPython</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">display </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> Markdown</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> display</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> sqlalchemy </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">    create_engine</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    MetaData</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    Table</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    Column</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    String</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    Integer</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    Float</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    select</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    insert</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 创建内存数据库</span></span>
<span class="line"><span style="color:#A6ACCD;">engine </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">create_engine</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">sqlite:///:memory:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">metadata_obj </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">MetaData</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 创建产品库存表</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">table_name </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">product_inventory</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">product_inventory_table </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Table</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">    table_name</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">    metadata_obj</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">    Column</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">product_id</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> String</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">16</span><span style="color:#89DDFF;">),</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">primary_key</span><span style="color:#89DDFF;">=True),</span></span>
<span class="line"><span style="color:#82AAFF;">    Column</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">product_name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> String</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">50</span><span style="color:#89DDFF;">),</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">nullable</span><span style="color:#89DDFF;">=False),</span></span>
<span class="line"><span style="color:#82AAFF;">    Column</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">quantity</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> Integer</span><span style="color:#89DDFF;">),</span></span>
<span class="line"><span style="color:#82AAFF;">    Column</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">unit_price</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> Float</span><span style="color:#89DDFF;">),</span></span>
<span class="line"><span style="color:#82AAFF;">    Column</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">category</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> String</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">20</span><span style="color:#89DDFF;">)),</span></span>
<span class="line"><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">metadata_obj</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create_all</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">engine</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> llama_index</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">core </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> SQLDatabase</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 初始化LLM</span></span>
<span class="line"><span style="color:#A6ACCD;">llm </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">OpenRouter</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#A6ACCD;font-style:italic;">api_key</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">os</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">environ</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">OPENROUTER_API_KEY</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">),</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#A6ACCD;font-style:italic;">max_tokens</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">4096</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#A6ACCD;font-style:italic;">context_window</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">131072</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#A6ACCD;font-style:italic;">model</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">qwen/qwen-2.5-72b-instruct</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 创建SQL数据库对象</span></span>
<span class="line"><span style="color:#A6ACCD;">sql_database </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">SQLDatabase</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">engine</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">include_tables</span><span style="color:#89DDFF;">=[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">product_inventory</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 创建SQL数据库对象</span></span>
<span class="line"><span style="color:#A6ACCD;">sql_database </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">SQLDatabase</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">engine</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">include_tables</span><span style="color:#89DDFF;">=[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">product_inventory</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 插入50条示例数据请自行模拟</span></span>
<span class="line"><span style="color:#A6ACCD;">rows </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> row </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> rows</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    stmt </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">insert</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">product_inventory_table</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">values</span><span style="color:#89DDFF;">(**</span><span style="color:#82AAFF;">row</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">with</span><span style="color:#A6ACCD;"> engine</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">begin</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#A6ACCD;"> connection</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        connection</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">execute</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">stmt</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 查看当前表内容</span></span>
<span class="line"><span style="color:#A6ACCD;">stmt </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">select</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">    product_inventory_table</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">c</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">product_id</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">    product_inventory_table</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">c</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">product_name</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">    product_inventory_table</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">c</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">quantity</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">    product_inventory_table</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">c</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">unit_price</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">    product_inventory_table</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">c</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">category</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">select_from</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">product_inventory_table</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#演示如何执行原始 SQL 查询，该查询可直接在表上执行</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> sqlalchemy </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> text</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">with</span><span style="color:#A6ACCD;"> engine</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">connect</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#A6ACCD;"> connection</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    results </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> connection</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">execute</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">stmt</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">fetchall</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> row </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> results</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">row</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> llama_index</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">core</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">query_engine </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> NLSQLTableQueryEngine</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 创建查询引擎</span></span>
<span class="line"><span style="color:#A6ACCD;">query_engine </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">NLSQLTableQueryEngine</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#A6ACCD;font-style:italic;">sql_database</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">sql_database</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">tables</span><span style="color:#89DDFF;">=[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">product_inventory</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">],</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">llm</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">llm</span></span>
<span class="line"><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 示例查询</span></span>
<span class="line"><span style="color:#A6ACCD;">query_str </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">哪个类别的产品种类最多？</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">response </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> query_engine</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">query</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">query_str</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">display</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">Markdown</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;&lt;b&gt;</span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">response</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">&lt;/b&gt;&quot;</span><span style="color:#89DDFF;">))</span></span>
<span class="line"></span>
<span class="line"></span></code></pre></div>`,3),t=[o];function e(c,D,r,F,y,i){return a(),n("div",null,t)}const f=s(p,[["render",e]]);export{C as __pageData,f as default};
